# v1.1.1-a.1 Quick Reference Card

## üÜï New API

### create_runtime_component()
```gdscript
RID create_runtime_component(world_id: RID, component_name: String, fields: Dictionary) -> RID
```

**Creates component at runtime with typed fields using Flecs reflection.**

**Example:**
```gdscript
var comp = flecs.create_runtime_component(world_id, "Health", {
    "current": 100,    # int
    "max": 100,        # int
    "regen": 5.0       # float
})
```

**Supported Types:**
- Primitives: `bool`, `int`, `float`
- Strings: `String`, `StringName`
- Math: `Vector2/3/4`, `Transform2D/3D`, `Quaternion`, `Color`
- Containers: `Array`, `Dictionary`
- Resources: `RID`
- 20+ total types

---

## ‚ö†Ô∏è Deprecated API

### register_component_type() [DEPRECATED]
```gdscript
# OLD - Will be removed in v2.0.0
RID register_component_type(world_id: RID, type_name: String, data: Dictionary)
```

**Status:** Deprecated, prints warning once per session

**Replace with:** `create_runtime_component()`

**Why:** 2-5x slower, no type safety, heap-allocated Dictionary

---

## üîÑ Quick Migration

```gdscript
# BEFORE (deprecated):
var comp = flecs.register_component_type(world_id, "Player", {})
flecs.set_component(entity, "Player", {"hp": 100, "name": "Hero"})

# AFTER (new):
var comp = flecs.create_runtime_component(world_id, "Player", {
    "hp": 100,
    "name": ""
})
flecs.set_component(entity, "Player", {"hp": 100, "name": "Hero"})
```

---

## üîß Build Options

```bash
# Standard build (deprecated method available with warning)
scons target=editor dev_build=yes

# Strict build (deprecated method removed)
scons DISABLE_DEPRECATED=yes target=editor dev_build=yes
```

---

## üìö Documentation

| Guide | Lines | Purpose |
|-------|-------|---------|
| [RUNTIME_COMPONENTS.md](RUNTIME_COMPONENTS.md) | 403 | Complete API guide |
| [MIGRATION_REGISTER_TO_RUNTIME.md](MIGRATION_REGISTER_TO_RUNTIME.md) | 481 | Step-by-step migration |
| [DEPRECATION_SUMMARY.md](DEPRECATION_SUMMARY.md) | 363 | Technical details |
| [runtime_component_example.gd](examples/runtime_component_example.gd) | 153 | 8 practical examples |

---

## ‚ö° Performance

| Method | Component Access | Memory |
|--------|------------------|--------|
| **OLD** `register_component_type()` | 50-100ns | Heap Dictionary |
| **NEW** `create_runtime_component()` | 10-20ns | Stack struct |
| **Improvement** | **2-5x faster** | **Better cache** |

---

## üìÖ Timeline

| Version | Status |
|---------|--------|
| v1.1.0-a.1 and earlier | ‚úÖ Old method fully supported |
| **v1.1.1-a.1 (now)** | ‚ö†Ô∏è **Old method deprecated** |
| v1.x.x | ‚ö†Ô∏è Old method still works (warning) |
| v2.0.0 | ‚ùå **Old method removed** |

---

## ‚úÖ Migration Checklist

- [ ] Find all `register_component_type()` calls
- [ ] Define field schemas for each component
- [ ] Update to `create_runtime_component()`
- [ ] Test functionality
- [ ] Optional: Verify with `DISABLE_DEPRECATED=yes`

---

## üöÄ Quick Start Example

```gdscript
extends Node

func _ready():
    var flecs = FlecsServer.get_singleton()
    var world = flecs.create_world()
    flecs.init_world(world)
    
    # Create components
    var health = flecs.create_runtime_component(world, "Health", {
        "current": 100,
        "max": 100
    })
    
    var transform = flecs.create_runtime_component(world, "Transform", {
        "position": Vector3.ZERO,
        "rotation": Quaternion.IDENTITY
    })
    
    # Create entity
    var entity = flecs.create_entity_with_name(world, "Player")
    flecs.add_component(entity, health)
    flecs.add_component(entity, transform)
    
    # Set data
    flecs.set_component(entity, "Health", {"current": 75, "max": 100})
    flecs.set_component(entity, "Transform", {
        "position": Vector3(10, 0, 5),
        "rotation": Quaternion.IDENTITY
    })
    
    # Get data
    var hp = flecs.get_component_by_name(entity, "Health")
    print("HP: ", hp["current"], "/", hp["max"])
```

---

## üõ†Ô∏è Troubleshooting

**"Component already exists" error:**
```gdscript
var comp = flecs.create_runtime_component(world, "Health", {...})
if !comp.is_valid():
    comp = flecs.lookup(world, "Health")  # Use existing
```

**Type mismatch:**
```gdscript
# Define correct type upfront
var comp = flecs.create_runtime_component(world, "Score", {
    "points": 0  # int, not 0.0 (float) or "0" (String)
})
```

**Migration verification:**
```bash
# After migration, test with strict build
scons DISABLE_DEPRECATED=yes target=editor
# If succeeds, migration complete!
```

---

**Version:** v1.1.1-a.1  
**Release:** 2025-01-28  
**Breaking Changes:** None  
**Migration:** Optional until v2.0.0